const loginContent=document.getElementById("login-page"),loginForm=document.getElementById("loginForm"),errorText=document.getElementById("error"),loadingFetch=document.getElementById("loading-fetch"),overlay=document.getElementById("overlay-login"),loadingLogin=document.getElementById("loading-login"),loggedOutDiv=document.getElementById("logged-out");let loginAttempts=0;const maxAttempts=5,lockoutDuration=30;function toggleBodyScroll(){"block"===overlay.style.display?document.body.classList.add("no_scroll"):document.body.classList.remove("no_scroll")}function updateLoginUI(e){e?(overlay.style.display="none",loginContent.style.display="none",loggedOutDiv.style.display="flex"):(overlay.style.display="block",loadingFetch.style.display="none",loggedOutDiv.style.display="none"),toggleBodyScroll()}loadingFetch.style.display="block",overlay.style.display="none";const isLoggedIn="true"===localStorage.getItem("loggedIn");function checkLockout(){const e=localStorage.getItem("lockoutEndTime");if(e){const o=(e-Date.now())/1e3;return o>0?(lockLoginForm(o),!0):(localStorage.removeItem("lockoutEndTime"),!1)}return!1}function handleFailedLogin(){++loginAttempts>=maxAttempts?lockLoginForm(lockoutDuration):(toastNotif(`You have ${maxAttempts-loginAttempts} attempts remaining.`),errorText.textContent="Login failed. Username or Password is incorrect.",errorText.style.display="block")}function lockLoginForm(e){toastNotif("Maximum Login Attempts Reached"),overlay.style.display="none";let o=document.getElementById("countdown");o||((o=document.createElement("div")).id="countdown",loginContent.appendChild(o));const t=Date.now()+1e3*e;localStorage.setItem("lockoutEndTime",t);const n=setInterval(()=>{const e=Date.now(),l=Math.round((t-e)/1e3);l>0?o.textContent=`Please wait ${l} seconds.`:(clearInterval(n),o.remove(),overlay.style.display="block",loginAttempts=0,localStorage.removeItem("lockoutEndTime"))},1e3)}updateLoginUI(isLoggedIn),loginForm.onsubmit=async function(e){e.preventDefault();const o=document.getElementById("username").value,t=document.getElementById("password").value;loadingLogin.style.display="flex",errorText.style.display="none";try{const e=await fetch("https://script.google.com/macros/s/AKfycbx1G4YHDsopQ3rd-K7owskKTkVXecCri4rDNH8DGJ5FrDcukAHpD0jQoT-3Ghla_y0rfA/exec",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`username=${encodeURIComponent(o)}&password=${encodeURIComponent(t)}`}),n=await e.json();loadingLogin.style.display="none",e.ok&&n.success?(localStorage.setItem("loggedIn","true"),localStorage.setItem("userName",n.name),localStorage.setItem("userFetchedDetails",JSON.stringify(n.details||{})),toastNotif("Welcome "+n.name),loginAttempts=0,location.reload()):handleFailedLogin()}catch(e){loadingLogin.style.display="none",errorText.textContent="An error occurred while processing your request. Please check your internet connection and try again.",errorText.style.display="block"}},loggedOutDiv.addEventListener("click",function(){localStorage.removeItem("loggedIn"),localStorage.removeItem("userName"),localStorage.getItem("userFetchedDetails")&&localStorage.removeItem("userFetchedDetails"),updateLoginUI(!1),loginForm.reset(),loginContent.style.display="block",overlay.style.display="none",loadingLogin.style.display="flex",toastNotif("Logged Out Successfully"),location.reload()}),checkLockout()||updateLoginUI(isLoggedIn);

var columnMembers=document.querySelectorAll(".column-member"),recentBlocks=document.querySelectorAll(".recent-blocks"),recentLoginLanguages=document.querySelectorAll(".recent-login-language"),textInnerHeads=document.querySelectorAll(".text-inner-head"),lyricsSubmitForms=document.querySelectorAll(".lyrics-submit-form"),claimedPageBoxes=document.querySelectorAll(".claimedPageBox"),verifyHeroes=document.querySelectorAll(".verifyHero");function setClasses(){"true"===localStorage.getItem("loggedIn")&&(columnMembers.forEach((e=>e.style.display="grid")),recentBlocks.forEach((e=>e.style.display="block")),recentLoginLanguages.forEach((e=>e.style.display="block")),textInnerHeads.forEach((e=>e.style.display="block")),lyricsSubmitForms.forEach((e=>e.style.display="block")),claimedPageBoxes.forEach((e=>e.style.display="block")),verifyHeroes.forEach((e=>e.style.display="flex")),clearInterval(checkInterval))}setClasses();var checkInterval=setInterval((function(){setClasses()}),1e3);

class LocalStorageObserver{constructor(){this.eventTarget=new EventTarget}setItem(e,t){const n=localStorage.getItem(e);localStorage.setItem(e,t),this.eventTarget.dispatchEvent(new CustomEvent("storageChange",{detail:{key:e,newValue:t,oldValue:n}}))}getItem(e){return localStorage.getItem(e)}removeItem(e){const t=localStorage.getItem(e);localStorage.removeItem(e),this.eventTarget.dispatchEvent(new CustomEvent("storageChange",{detail:{key:e,newValue:null,oldValue:t}}))}onStorageChange(e){this.eventTarget.addEventListener("storageChange",e)}}const storageObserver=new LocalStorageObserver;function timeAgo(e){const t=new Date,n=new Date(e),a=Math.floor((t-n)/1e3);if(isNaN(a)||a<0)return"Invalid date";const o=Math.floor(a/60),r=Math.floor(o/60),s=Math.floor(r/24),l=Math.floor(s/30),i=Math.floor(l/12);return i>0?`${i} year${i>1?"s":""} ago`:l>0?`${l} month${l>1?"s":""} ago`:s>0?`${s} day${s>1?"s":""} ago`:r>0?`${r} hour${r>1?"s":""} ago`:o>0?`${o} minute${o>1?"s":""} ago`:`${a} second${a>1?"s":""} ago`}function sanitizeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function validateUrl(e){return e.startsWith("http://")||e.startsWith("https://")?e:"javascript:;"}function fetchDataFromGoogleSheetAndUpdateIfNecessary(e,t=null){const n=new FormData;n.append("name",e),fetch("https://script.google.com/macros/s/AKfycbw4lJ00CLdxbEiK7tO7ZPPRY9ZktRqyKXfoNOIdTqiphB32WzGjFHPlPeJjSH9PiL5e/exec",{method:"POST",body:n}).then(e=>e.json()).then(e=>{if(["active","deactive"].includes(e.status)){!t||JSON.stringify(t)!==JSON.stringify(e)?updateLocalStorageAndDisplay(e):displayDetails(t,!1)}else console.error("Invalid user status received from Google Sheets."),toastNotif("User status is unknown.")}).catch(e=>{console.error("Error:",e),toastNotif("An error occurred while processing your request.")})}function updateLocalStorageAndDisplay(e){storageObserver.setItem("userFetchedDetails",JSON.stringify(e)),displayDetails(e,!0)}function displayDetails(e,t){const n=document.getElementById("result"),a=document.getElementById("nameHeader"),o=document.getElementById("status");a.textContent=`${e.name}`,o.innerHTML="";const r=document.createElement("span");r.textContent="active"===e.status?"Active":"Inactive",r.style.color="active"===e.status?"#00ff00":"#e91429",o.appendChild(r),document.getElementById("roleType").textContent=`${e.roleType}`,document.getElementById("location").textContent=`${e.location}`,document.getElementById("image").src=e.imageUrl||"default-image-url.png";const s=new Date(e.showDate);document.getElementById("showDate").textContent=timeAgo(s);const l=new Date(e.dateOfBirth),i=(new Date).getFullYear()-l.getFullYear();document.getElementById("dateOfBirth").textContent=`${i} years`,document.getElementById("languageWork").textContent=`${e.languageWork}`;const c=e.pendingSongs?e.pendingSongs.split(", ").map(e=>`<span class="songRequested">${sanitizeHTML(e.trim())}</span>`).join(""):"Nothing To Show, Keep Browsing";document.getElementById("pendingSongs").innerHTML=c,document.getElementById("noticeField").innerHTML=e.noticeField?`<span>${sanitizeHTML(e.noticeField)}</span>`:"There is currently no new notice available for you. Please continue to browse the site, and we will promptly update this section with any new information as it becomes available.",document.getElementById("emailUser").textContent=`${e.emailUser}`,document.getElementById("claimedPage").href=validateUrl(e.claimedPage),document.getElementById("facebookUrl").href=validateUrl(e.facebookUrl),document.getElementById("twitterUrl").href=validateUrl(e.twitterUrl),document.getElementById("instagramUrl").href=validateUrl(e.instagramUrl),n.style.visibility="visible"}function checkLocalStorageForUsername(){const e=storageObserver.getItem("userName"),t=JSON.parse(storageObserver.getItem("userFetchedDetails"));e&&(t&&t.name===e?(displayDetails(t,!1),fetchDataFromGoogleSheetAndUpdateIfNecessary(e,t)):fetchDataFromGoogleSheetAndUpdateIfNecessary(e))}function validateUrl(e){return e.startsWith("http://")||e.startsWith("https://")?e:"javascript:;"}storageObserver.onStorageChange(e=>{const{key:t,newValue:n}=e.detail;"userName"===t&&n&&(console.log(`UserName changed to "${n}"`),checkLocalStorageForUsername())}),checkLocalStorageForUsername();

const userName=localStorage.getItem("userName");if(userName){document.getElementById("nameHeader").innerText=userName}

!function(){function e(){const e=document.querySelector(".roleType");if(!e)return;const c=e.textContent.trim(),i={"Content Writer":t,Artist:n,Admin:o,Developer:r};for(const e in i)if(c.includes(e)){i[e]();break}}function t(){i(".pBtns.work"),i(".lyrics-submit-form")}function n(){i(".claimedPageBox"),c(".languageWork"),i(".recent-login-language.language"),c(".recent-blocks.pendingSongsBox"),function(e,t){const n=document.querySelector(e);n&&Object.entries(t).forEach(([e,t])=>{n.style.setProperty(e,t,"important")})}(".result",{"min-height":"607px"})}function o(){i(".claimedPageBox"),i(".lyrics-submit-form"),i(".pBtns.work")}function r(){c(".ptabs"),c(".recent-blocks.pendingSongsBox");const e=document.querySelector(".recent-login-language.language");if(e){if(!e.querySelector("iframe")){const t='<iframe src="https://www.programiz.com/html/online-compiler/" style="width: 100%; height: 680px"></iframe>';e.innerHTML="",e.insertAdjacentHTML("beforeend",t)}!function(e,t){const n=document.querySelector(e);n&&(n.style.cursor="not-allowed",n.addEventListener("click",e=>{e.preventDefault(),toastNotif(t)}))}(".lyrics-submit-form","Developers Are Not Allowed To Use This Form")}}function c(e){const t=document.querySelector(e);t&&t.style.setProperty("display","none","important")}function i(e){const t=document.querySelector(e);t&&t.classList.remove("hidden")}const s=document.querySelector(".result");if(s){new MutationObserver(e).observe(s,{childList:!0,subtree:!0})}e()}();

var anchors=document.querySelectorAll("a");anchors.forEach((function(t){t.addEventListener("click",(function(t){"javascript:;"===this.getAttribute("href")&&(toastNotif("Fetching..."),setTimeout((function(){toastNotif("Nothing Found")}),2e3),t.preventDefault())}))}));

function updateClock(){var t=document.getElementById("hour").querySelector("span"),e=document.getElementById("minute").querySelector("span"),n=document.getElementById("seconds").querySelector("span");setInterval(function(){var u=new Date,a=u.getHours(),o=u.getMinutes(),r=u.getSeconds();a<10&&(a="0"+a),o<10&&(o="0"+o),r<10&&(r="0"+r),t.setAttribute("data-text",a),e.setAttribute("data-text",o),n.setAttribute("data-text",r)},1e3)}updateClock();

function updateGreeting(){const e=(new Date).getHours(),t=["Have a Sweet Dreams!","Good Morning!","Good Afternoon!","Good Evening!","Good Night!","It's time to sleep!"];let o="";o=e<4?t[0]:e<12?t[1]:e<17?t[2]:e<19?t[3]:e<22?t[4]:t[5];const n=localStorage.getItem("userName")||"User";o=`${o}`;const r=document.querySelector(".greetings");r&&r.setAttribute("data-text",o);const s=document.querySelector(".user-fetched-top");s&&s.setAttribute("data-text",`${n}`)}updateGreeting();

function menuShowLogin(){const e=document.querySelector(".menuItm.sReq button"),t=document.querySelector(".menuItm.notice button"),n=document.querySelector(".dropMCX"),o=document.querySelector(".pendingSongsBox"),s=document.querySelector(".noticeFieldBox"),c=document.querySelector(".dropMCX .dropMCXB"),d=document.querySelector("#pendingSongs"),i=document.querySelector("#noticeField");function r(){n.classList.remove("active"),o.classList.add("hidden"),s.classList.add("hidden")}e.addEventListener("click",e=>{o.classList.remove("hidden"),s.classList.add("hidden"),n.classList.add("active"),e.stopPropagation()}),t.addEventListener("click",e=>{s.classList.remove("hidden"),o.classList.add("hidden"),n.classList.add("active"),e.stopPropagation()}),c.addEventListener("click",()=>{r()}),document.addEventListener("click",o=>{n.contains(o.target)||e.contains(o.target)||t.contains(o.target)||r()}),new MutationObserver(()=>{const t=d.querySelectorAll("span").length;t>0?e.setAttribute("data-count",t):e.removeAttribute("data-count")}).observe(d,{childList:!0,subtree:!0}),new MutationObserver(()=>{i.querySelectorAll("span").length>0?t.classList.add("active"):t.classList.remove("active")}).observe(i,{childList:!0,subtree:!0})}menuShowLogin();
